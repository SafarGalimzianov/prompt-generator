{% extends 'layout.html' %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h2>üîß –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è Deep Research –≤ ChatGPT</h2>
            </div>
            <div class="card-body">
                <form action="/generate" method="POST">
                    <div class="mb-3">
                        <label for="topic" class="form-label">1. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:</label>
                        <input type="text" class="form-control" id="topic" name="topic" required value="{{ form_data.topic if form_data else '' }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="report_lang" class="form-label">2. –ù–∞ –∫–∞–∫–æ–º —è–∑—ã–∫–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç—á–µ—Ç?</label>
                        <select class="form-select" id="report_lang" name="report_lang">
                            <option value="—Ä—É—Å—Å–∫–∏–π" {% if form_data and form_data.report_lang == '—Ä—É—Å—Å–∫–∏–π' %}selected{% endif %}>–†—É—Å—Å–∫–∏–π</option>
                            <option value="–∞–Ω–≥–ª–∏–π—Å–∫–∏–π" {% if form_data and form_data.report_lang == '–∞–Ω–≥–ª–∏–π—Å–∫–∏–π' %}selected{% endif %}>–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                            <option value="–¥—Ä—É–≥–æ–π" {% if form_data and form_data.report_lang == '–¥—Ä—É–≥–æ–π' %}selected{% endif %}>–î—Ä—É–≥–æ–π</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="search_lang" class="form-label">3. –ù–∞ –∫–∞–∫–æ–º —è–∑—ã–∫–µ –∏—Å–∫–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã?</label>
                        <select class="form-select" id="search_lang" name="search_lang">
                            <option value="–∞–Ω–≥–ª–∏–π—Å–∫–∏–π" {% if form_data and form_data.search_lang == '–∞–Ω–≥–ª–∏–π—Å–∫–∏–π' %}selected{% endif %}>–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                            <option value="—Ä—É—Å—Å–∫–∏–π" {% if form_data and form_data.search_lang == '—Ä—É—Å—Å–∫–∏–π' %}selected{% endif %}>–†—É—Å—Å–∫–∏–π</option>
                            <option value="–æ–±–∞" {% if form_data and form_data.search_lang == '–æ–±–∞' %}selected{% endif %}>–û–±–∞</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="depth" class="form-label">4. –ö–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –≥–ª—É–±–∏–Ω—ã?</label>
                        <select class="form-select" id="depth" name="depth">
                            <option value="–≤–≤–µ–¥–µ–Ω–∏–µ" {% if form_data and form_data.depth == '–≤–≤–µ–¥–µ–Ω–∏–µ' %}selected{% endif %}>–í–≤–µ–¥–µ–Ω–∏–µ</option>
                            <option value="–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π" {% if form_data and form_data.depth == '–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π' %}selected{% endif %}>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
                            <option value="—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π" {% if form_data and form_data.depth == '—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π' %}selected{% endif %}>–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="source_type" class="form-label">5. –ö–∞–∫–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?</label>
                        <select class="form-select" id="source_type" name="source_type">
                            <option value="–Ω–∞—É—á–Ω—ã–µ" {% if form_data and form_data.source_type == '–Ω–∞—É—á–Ω—ã–µ' %}selected{% endif %}>–ù–∞—É—á–Ω—ã–µ</option>
                            <option value="–ª—é–±—ã–µ" {% if form_data and form_data.source_type == '–ª—é–±—ã–µ' %}selected{% endif %}>–õ—é–±—ã–µ</option>
                            <option value="—Ç–æ–ª—å–∫–æ peer-reviewed" {% if form_data and form_data.source_type == '—Ç–æ–ª—å–∫–æ peer-reviewed' %}selected{% endif %}>–¢–æ–ª—å–∫–æ peer-reviewed</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="year_cutoff" class="form-label">6. –° –∫–∞–∫–æ–≥–æ –≥–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏?</label>
                        <input type="text" class="form-control" id="year_cutoff" name="year_cutoff" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 2017" value="{{ form_data.year_cutoff if form_data else '2017' }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="keywords" class="form-label">7. –£–∫–∞–∂–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º:</label>
                        <input type="text" class="form-control" id="keywords" name="keywords" value="{{ form_data.keywords if form_data else '' }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="files_included" class="form-label">8. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã?</label>
                        <select class="form-select" id="files_included" name="files_included">
                            <option value="no" {% if form_data and form_data.files_included == 'no' %}selected{% endif %}>–ù–µ—Ç</option>
                            <option value="yes" {% if form_data and form_data.files_included == 'yes' %}selected{% endif %}>–î–∞</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="banality" class="form-label">9. –ß—Ç–æ –≤ —Ç–µ–º–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –±–∞–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é –∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å—Å—è?</label>
                        <input type="text" class="form-control" id="banality" name="banality" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: '–ò–ò ‚Äî —ç—Ç–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç'" value="{{ form_data.banality if form_data else '' }}">
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        {% if prompt %}
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2>‚úÖ –ì–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç</h2>
                <button class="btn btn-sm btn-outline-secondary" onclick="copyPrompt()">
                    üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>
            <div class="card-body">
                <pre id="prompt-content" class="p-3 bg-light" style="white-space: pre-wrap;">{{ prompt }}</pre>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function copyPrompt() {
    const promptContent = document.getElementById('prompt-content');
    
    // Create a range and select the text
    const range = document.createRange();
    range.selectNode(promptContent);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
    
    // Copy the text to clipboard
    document.execCommand('copy');
    
    // Deselect the text
    window.getSelection().removeAllRanges();
    
    // Show a notification or change button text temporarily
    const copyButton = document.querySelector('button.btn-outline-secondary');
    const originalText = copyButton.innerHTML;
    copyButton.innerHTML = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
    
    setTimeout(() => {
        copyButton.innerHTML = originalText;
    }, 2000);
}
</script>
{% endblock %}